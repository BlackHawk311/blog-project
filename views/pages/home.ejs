<main>
    <!-- <p>This should be the homepage of the project.</p> -->

    <form class="post-form" action="/post" method="POST">
        <h2>Create new post</h2>
        <div>
            <input name="title" type="text" placeholder="Post title">
        </div>
        <div>
            <input name="postBody" type="text" placeholder="Post body">
        </div>
        <div>
            <button type="submit">Create new post</button>
        </div>
    </form>

    <div>
        <% allPosts.forEach(p => { %>
            <div class="post-container">
                <h3><%= p.title %></h3>
                <p><%= p.body %></p>
                <div>
                    <button id="<%= p.id %>" class="edit" onclick="handleEditPost(event)">Edit</button>
                    <button id="<%= p.id %>" class="delete" onclick="handleDeletePost(event)">Delete</button>
                </div>
            </div>
        <% }) %>
    </div>
</main>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    async function handleEditPost(event) {
        // sails.log.warn(event.target.id)
        console.log(event.target.id)
    }
    async function handleDeletePost(event) {
        // sails.log.warn(event.target.id)
        console.log(event.target.id)

        const postId = event.target.id
        const url = '/post/' + postId

        try {
            const response = await axios.delete(url)
            console.log(response)
            location.reload()
        } catch (error) {
            console.error(error.toString())
            alert(error.toString())
        }
    }
</script>